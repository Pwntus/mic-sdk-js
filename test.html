<html>
  <head>
    <title>MIC SDK JS Test</title>
    <!-- Load c3.css -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.13/c3.min.css" rel="stylesheet">
  </head>
  <body>
    <!-- Our chart -->
    <div id="chart"></div>

    <!-- Load d3.js and c3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.1/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.13/c3.min.js"></script>

    <script type="application/javascript" src="./dist/mic-sdk-js.min.js"></script>
    <script>
      // Create the chart
      var chart = c3.generate({
        bindto: '#chart',
        data: {
          x: 'x',
          columns: [
            ['x'],
            ['data']
          ]
        },
        axis: {
          x: {
            type: 'timeseries',
            tick: {
              format: '%Y-%m-%d'
            }
          }
        }
      });

      // Get the MIC library
      var MIC = window.MIC.default;

      // Init with username and password
      MIC.init({ username: '', password: '' })
        .then(function () {

          // Do an Elasticsearch query to get Thing data
          MIC.elasticsearch({
            query: {
              size: 5000,
              query: {
                bool: {
                  filter: [
                    {
                      term: {
                        thingName: '00001536'
                      }
                    }
                  ]
                }
              }
            }
          })
            .then(function (result) {
              // Filter the data for our chart
              var x = ['x'];
              var y = ['data'];
              for (let i in result.hits.hits) {
                var timestamp = result.hits.hits[i]._source.timestamp || 0;
                var temperature = result.hits.hits[i]._source.state.Temp || 0;

                // Add to new dataset
                x.push(timestamp);
                y.push(temperature);
              }

              // Swap out old data with new in our chart
              chart.load({
                unload: true,
                columns: [x, y]
              });
            })
            .catch(function (e) {
              console.log('Error: ', e);
            });
        })
        .catch(function () {
          console.log('Error: ', e);
        });
    </script>
  </body>
</html>
